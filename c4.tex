\chapter{C4}

\begin{sagesilent}

import numpy as np
from scipy import odr
import matplotlib.pyplot as plt

trasfm = np.recfromcsv("dati/C4-tensione-fase.csv")
chiquad = load("sobj/chiquad.sobj")
#Sottosmorzamento tempo-volt
#Smorzamento critico tempo-volt
#Sovrasmorzamento tempo-volt
\end{sagesilent}


\begin{sagesilent}

#Funzione di trasferimento del modulo: freq-volt
#RLC in corrente alternata
dati = np.recfromcsv("dati/C4-tensione-fase.csv")
var('x,l,c,v,w')
r = 300
def f(x, l, w, v):
    return (v*2*3.14*x*w)/( sqrt( (2*3.14*x*w)^2+(w*l/r)^2*((2*3.14*x)^2-w^2)^2 ) )
    
puls = dati['frequenza_hz'] #*2*3.14
ennupla = list(((puls[i]), dati['v_out__v_in'][i]) for i in range(0,len(dati['frequenza_hz'])))


fit = find_fit(ennupla, f, parameters=[l,w,v], variables=[x], solution_dict=True)

print fit

plt.clf()
xin = np.arange(100, 100000, 10)
yin = f(xin, fit[l], fit[w], fit[v])
plt.semilogx(xin,yin, 'g--')
plt.semilogx(dati['frequenza_hz'], dati['v_out__v_in'], 'ok')

plt.xlabel(r"$\omega$ [$rad/s$]")
plt.ylabel(r"$V(\omega)$ [$rad$]")
plt.grid(True)

plt.savefig("grafici/C4-ris.png", dpi=300)

#Funzione di trasferimento fase:freq-rad
  
\end{sagesilent}

\includegraphics[scale=0.75]{grafici/C4-ris.png}



%Sottosmorzamento
\begin{sagesilent}
 
om = 2*n(pi)*100
t =np.array([190,570,950,1520])
picchi=np.array([520,-148,60,-24])

def func(P,x):
    return P[0]*P[1]*P[2]*exp(-P[3]*t)*(P[3]*cos(om*x)+om*sin(100*x))

#var('x,r,c,v,g')
#def f(x,r,c, v, g):
#    return r*c*v*exp(-g*t)*(g*cos(om*x)+om*sin(100*x))
    
plt.clf()
plt.plot(t,picchi,'bo')

mod = odr.Model(func)
data = odr.RealData(t,picchi)
done = odr.ODR(data, mod, beta0=[1.,1.,1.,1.],maxit=1000)
sotto = done.run()

#xin = np.arange(min(t),max(t),1)
#yin = func(sotto.beta, xin)

#plt.plot(xin,yin,'g--')
plt.xlabel(r"$\omega$ [$rad/s$]")
plt.ylabel(r"$V(\omega)$ [$rad$]")
plt.savefig("grafici/C4-om.png",dpi=300)
 
\end{sagesilent}

\begin{center}
 \includegraphics[scale=0.75]{grafici/C4-om.png}
\end{center}

%Funzione di trasferimento del modulo
% \begin{sagesilent}
% 
% freq = trasfm['frequenza_hz']
% v = trasfm['v_out_v_in']
% 
% #Funzione di trasferimento del modulo
% 
% def fu(P,x):
%     return (P[0]*2*3.14*x*P[1])/( sqrt( (2*3.14*x*P[1])^2+(w*P[2]/R)^2*((2*3.14*x)^2-[1]^2)^2 ) )
% 
%   
% myodr, chi = fit_chiquad(freq, v, fu, ysigma=yerr, param=[mytransm.beta])
% print "Chi quadro %.4f" % chi
%   
% \end{sagesilent}

